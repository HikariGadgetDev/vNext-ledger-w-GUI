<!-- root/vnext-ledger/index.htmx -->

<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>vNext Ledger - åˆ¤æ–­ã‚’å¤±ã‚ãªã„å°å¸³</title>
  <!-- ã‚ªãƒ•ãƒ©ã‚¤ãƒ³å¯¾å¿œ:ãƒ­ãƒ¼ã‚«ãƒ«ã® htmx ã‚’ä½¿ç”¨ -->
  <script src="/static/vendor/htmx.min.js"></script>
  <script src="/static/ui.js" defer></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 2rem;
    }
    
    .container {
      max-width: 1400px;
      margin: 0 auto;
      background: white;
      border-radius: 1rem;
      padding: 2rem;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
    }
    
    /* Header */
    header {
      margin-bottom: 2rem;
      padding-bottom: 1rem;
      border-bottom: 2px solid #e5e7eb;
    }
    
    .status-badge {
      display: inline-block;
      padding: 0.25rem 0.75rem;
      border-radius: 9999px;
      font-size: 0.75rem;
      font-weight: 600;
      margin-left: 1rem;
    }
    
    .status-badge.offline {
      background: #10b981;
      color: white;
    }
    
    .status-badge.online {
      background: #3b82f6;
      color: white;
    }
    
    h1 {
      font-size: 2.5rem;
      margin-bottom: 0.5rem;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      display: inline-block;
    }
    
    .subtitle {
      color: #6b7280;
      font-size: 1rem;
      margin-bottom: 0.5rem;
    }
    
    .tagline {
      color: #9ca3af;
      font-size: 0.875rem;
      font-style: italic;
    }
    
    /* Controls */
    .controls {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1rem;
      margin-bottom: 2rem;
      padding: 1.5rem;
      background: linear-gradient(135deg, #f9fafb 0%, #f3f4f6 100%);
      border-radius: 0.75rem;
      border: 2px solid #e5e7eb;
    }
    
    button {
      padding: 1rem 1.5rem;
      border: none;
      border-radius: 0.5rem;
      font-weight: 600;
      font-size: 0.95rem;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
    }
    
    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }
    
    button:active {
      transform: translateY(0);
    }
    
    .safe {
      background: linear-gradient(135deg, #10b981 0%, #059669 100%);
      color: white;
    }
    
    .dangerous {
      background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
      color: white;
    }
    
    .info {
      background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
      color: white;
    }
    
    .neutral {
      background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
      color: white;
    }

    .primary {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
    }
    
    /* Result Panel */
    #result {
      margin-bottom: 2rem;
      padding: 1.5rem;
      border-radius: 0.75rem;
      display: none;
    }
    
    #result.show {
      display: block;
      animation: slideIn 0.3s ease-out;
    }
    
    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    #result.success {
      background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%);
      border-left: 4px solid #10b981;
    }
    
    #result.danger {
      background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%);
      border-left: 4px solid #ef4444;
    }
    
    #result.info {
      background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
      border-left: 4px solid #3b82f6;
    }
    
    #result h3 {
      margin-bottom: 1rem;
      font-size: 1.25rem;
    }
    
    #result ul {
      list-style: none;
      padding-left: 0;
    }
    
    #result li {
      padding: 0.5rem 0;
      border-bottom: 1px solid rgba(0,0,0,0.05);
    }
    
    #result li:last-child {
      border-bottom: none;
    }
    
    #result strong {
      color: #374151;
      font-weight: 700;
    }
    
    /* Filters */
    #filters {
      display: flex;
      gap: 0.5rem;
      align-items: center;
      margin-bottom: 1rem;
      flex-wrap: wrap;
      padding: 1rem;
      background: linear-gradient(135deg, #f9fafb 0%, #f3f4f6 100%);
      border-radius: 0.5rem;
      border: 2px solid #e5e7eb;
    }
    
    #filters input[type="text"],
    #filters input[type="date"],
    #filters select {
      padding: 0.75rem;
      border: 2px solid #e5e7eb;
      border-radius: 0.5rem;
      font-size: 0.875rem;
      transition: border-color 0.2s;
    }
    
    #filters input[type="text"]:focus,
    #filters input[type="date"]:focus,
    #filters select:focus {
      outline: none;
      border-color: #667eea;
    }
    
    #filters input[type="text"] {
      flex: 1 1 320px;
    }
    
    #filters select,
    #filters input[type="date"] {
      flex: 0 0 auto;
    }
    
    #filters button[type="button"] {
      padding: 0.75rem 1rem;
      flex: 0 0 auto;
    }
    
    /* Table */
    .table-container {
      background: white;
      border-radius: 0.75rem;
      overflow: hidden;
      border: 2px solid #e5e7eb;
    }
    
    table {
      width: 100%;
      border-collapse: collapse;
    }
    
    thead {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
    }
    
    th {
      padding: 1rem;
      text-align: left;
      font-weight: 600;
      font-size: 0.875rem;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }
    
    td {
      padding: 1rem;
      border-bottom: 1px solid #e5e7eb;
    }
    
    tr:last-child td {
      border-bottom: none;
    }
    
    tbody tr {
      transition: background 0.15s;
    }
    
    tbody tr:hover {
      background: #f9fafb;
    }
    
    code {
      background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
      padding: 0.25rem 0.5rem;
      border-radius: 0.25rem;
      font-family: 'Monaco', 'Courier New', monospace;
      font-size: 0.875rem;
      color: #92400e;
      font-weight: 600;
    }
    
    .badge {
      display: inline-block;
      padding: 0.2rem 0.55rem;
      border-radius: 999px;
      font-size: 0.85rem;
      line-height: 1.2;
      border: 1px solid #e5e7eb;
    }
    
    .status-open {
      background: #eef2ff;
      border-color: #c7d2fe;
    }
    
    .status-doing {
      background: #ecfeff;
      border-color: #a5f3fc;
    }
    
    .status-parked {
      background: #fff7ed;
      border-color: #fed7aa;
    }
    
    .status-done {
      background: #f0fdf4;
      border-color: #bbf7d0;
    }
    
    .status-stale {
      background: #f3f4f6;
      border-color: #e5e7eb;
      color: #6b7280;
    }
    
    .priority {
      display: inline-flex;
      align-items: center;
      gap: 0.25rem;
    }
    
    .priority-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
    }
    
    .priority-1 .priority-dot { background: #ef4444; }
    .priority-2 .priority-dot { background: #f97316; }
    .priority-3 .priority-dot { background: #eab308; }
    .priority-4 .priority-dot { background: #22c55e; }
    .priority-5 .priority-dot { background: #3b82f6; }
    
    /* Loading */
    .loading {
      text-align: center;
      padding: 3rem;
      color: #9ca3af;
    }
    
    .spinner {
      display: inline-block;
      width: 40px;
      height: 40px;
      border: 4px solid #e5e7eb;
      border-top-color: #667eea;
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
      margin-bottom: 1rem;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    .htmx-request .loading {
      display: block;
    }
    
    .htmx-request > :not(.loading) {
      display: none;
    }
    
    /* Empty State */
    .empty-state {
      text-align: center;
      padding: 3rem;
      color: #9ca3af;
    }
    
    .empty-state-icon {
      font-size: 3rem;
      margin-bottom: 1rem;
    }
    
    /* Footer */
    footer {
      margin-top: 2rem;
      padding-top: 2rem;
      border-top: 2px solid #e5e7eb;
      text-align: center;
      color: #9ca3af;
      font-size: 0.875rem;
    }
    
    footer a {
      color: #667eea;
      text-decoration: none;
      font-weight: 600;
    }
    
    footer a:hover {
      text-decoration: underline;
    }

    /* ã‚ªãƒ•ãƒ©ã‚¤ãƒ³è¡¨ç¤º */
    .offline-notice {
      background: #10b981;
      color: white;
      padding: 0.5rem 1rem;
      border-radius: 0.5rem;
      margin-bottom: 1rem;
      text-align: center;
      font-size: 0.875rem;
      font-weight: 600;
    }

    /* Modal */
    .modal-backdrop { position: fixed; inset: 0; background: rgba(0,0,0,.35); padding: 6vh 8vw; z-index: 50; }
    .modal { background: #fff; border-radius: 16px; padding: 16px; max-width: 820px; margin: 0 auto; box-shadow: 0 12px 40px rgba(0,0,0,.18); }
    .modal-actions { display:flex; gap:.5rem; justify-content:flex-end; margin-top: 12px; }
    .modal-backdrop.show { display:block !important; }

    /* Sort header button */
    button.sort { background: transparent; border: none; padding: 0; cursor: pointer; font: inherit; color: inherit; }
    button.sort:hover { text-decoration: underline; }

  </style>
</head>
<body>
  <div class="container">
    <!-- Offline Notice -->
    <div class="offline-notice">
      âœ… å®Œå…¨ã‚ªãƒ•ãƒ©ã‚¤ãƒ³å‹•ä½œ | ãƒãƒƒãƒˆæ¥ç¶šä¸è¦ | ãƒ‡ãƒ¼ã‚¿ã¯ãƒ­ãƒ¼ã‚«ãƒ«ã«ä¿å­˜
    </div>

    <!-- Header -->
    <header>
      <h1>ğŸ§  vNext Ledger</h1>
      <span class="status-badge offline">ğŸ“¡ OFFLINE MODE</span>
      <p class="subtitle">è¨­è¨ˆåˆ¤æ–­ã‚’å¤±ã‚ãªã„ãŸã‚ã®è»½é‡å°å¸³</p>
      <p class="tagline">brother casval â†’ vNext | ã€Œä»Šã˜ã‚ƒãªã„åˆ¤æ–­ã€ã‚’æ§‹é€ ã§ä¿å­˜</p>
    </header>
    
    <!-- Controls -->
    <div class="controls">
      <button
        hx-post="/scan?full=0"
        hx-headers='{"Accept":"text/html"}'
        hx-target="#result"
        hx-swap="innerHTML"
        class="safe">
        <span>ğŸ“Š</span>
        <span>å·®åˆ†ã‚¹ã‚­ãƒ£ãƒ³</span>
      </button>

      <button
        hx-post="/scan?full=1"
        hx-headers='{"Accept":"text/html"}'
        hx-target="#result"
        hx-swap="innerHTML"
        hx-confirm="âš ï¸ ä¸–ç•Œã‚’é–‰ã˜ã¾ã™ã‹?&#10;&#10;ã“ã®æ“ä½œã¯ä»¥ä¸‹ã‚’å®Ÿè¡Œã—ã¾ã™:&#10;â€¢ stale åŒ–(è¦‹ã¤ã‹ã‚‰ãªã„åˆ¤æ–­ã‚’é™³è…åŒ–)&#10;â€¢ orphan å‰Šé™¤(å­¤å…ãƒ•ã‚¡ã‚¤ãƒ«ã®å‰Šé™¤)&#10;&#10;ä¸å¯é€†ãªæ“ä½œã§ã™ã€‚ç¶šã‘ã¾ã™ã‹?"
        class="dangerous">
        <span>ğŸ”¥</span>
        <span>å…¨èµ°æŸ»(å±é™º)</span>
      </button>

      <button
        hx-get="/export/summary"
        hx-headers='{"Accept":"text/html"}'
        hx-target="#result"
        hx-swap="innerHTML"
        class="info">
        <span>ğŸ“ˆ</span>
        <span>ã‚µãƒãƒªè¡¨ç¤º</span>
      </button>

      <button
        hx-get="/export/metrics?limit=10"
        hx-headers='{"Accept":"text/html"}'
        hx-target="#result"
        hx-swap="innerHTML"
        class="neutral">
        <span>ğŸ“Š</span>
        <span>ãƒ¡ãƒˆãƒªã‚¯ã‚¹</span>
      </button>
    </div>

    <!-- Result Panel -->
    <div id="result"></div>

    <!-- Filters (å”¯ä¸€ã®çŠ¶æ…‹ / å”¯ä¸€ã®æ›´æ–°ãƒˆãƒªã‚¬) -->
    <form id="filters"
          hx-get="/notes/table"
          hx-target="#notesTable"
          hx-swap="innerHTML"
          hx-trigger="
            load,
            every 30s,
            refresh,
            keyup changed delay:300ms from:#q,
            change from:#status,
            change from:#priority,
            change from:#comment,
            change from:#risk_level,
            change from:#since,
            change from:#until
          ">

      <input id="q" name="q" type="text"
             placeholder="ğŸ” æ¤œç´¢(slug/owner/decision/path)" />

      <select id="status" name="status">
        <option value="">status: all</option>
        <option value="open">open</option>
        <option value="doing">doing</option>
        <option value="parked">parked</option>
        <option value="done">done</option>
        <option value="stale">stale</option>
      </select>

      <select id="priority" name="priority">
        <option value="">priority: all</option>
        <option value="none">priority: noneï¼ˆæœªè©•ä¾¡ï¼‰</option>
        <option value="1">1ï¼ˆé«˜å„ªå…ˆï¼‰</option>
        <option value="2">2ï¼ˆä¸­å„ªå…ˆï¼‰</option>
        <option value="3">3ï¼ˆä½å„ªå…ˆï¼‰</option>
      </select>

      <select id="comment" name="comment">
        <option value="">comment: all</option>
        <option value="any">comment: ã‚ã‚Š</option>
        <option value="none">comment: ãªã—</option>
      </select>

      <select id="risk_level" name="risk_level">
        <option value="">risk: all</option>
        <option value="high">risk: high</option>
        <option value="critical">risk: critical</option>
        <option value="none">risk: noneï¼ˆé€šå¸¸ï¼‰</option>
      </select>

      <!-- type=date: å…¥åŠ›äº‹æ•…ã‚’æ¸›ã‚‰ã™ -->
      <input id="since" name="since" type="date" title="last_seen >= since" />
      <input id="until" name="until" type="date" title="last_seen <= until" />

      <!-- sort state (çœŸå®Ÿã¯ã‚¯ã‚¨ãƒª) -->
      <input type="hidden" id="sort" name="sort" value="priority" />
      <input type="hidden" id="dir" name="dir" value="asc" />

      <button type="button"
              id="clearFilters"
              class="neutral">
        <span>ğŸ§¹</span><span>ã‚¯ãƒªã‚¢</span>
      </button>
    </form>

    <!-- Ledger Table (è¡¨ç¤ºã ã‘) -->
    <div class="table-container">
      <div id="notesTable">
        <div class="loading">
          <div class="spinner"></div>
          <p>å°å¸³ã‚’èª­ã¿è¾¼ã¿ä¸­...</p>
        </div>
      </div>
    </div>

    <!-- Modal (HTMX detail/edit) -->
    <div id="modal" class="modal-backdrop" style="display:none;"></div>

    <!-- Footer -->
    <footer>
      <p>
        <strong>ğŸ”’ ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼</strong><br>
        ã™ã¹ã¦ã®ãƒ‡ãƒ¼ã‚¿ã¯ãƒ­ãƒ¼ã‚«ãƒ«ã«ä¿å­˜ã•ã‚Œã¾ã™ã€‚<br>
        å¤–éƒ¨ã‚µãƒ¼ãƒãƒ¼ã¸ã®é€ä¿¡ã¯è¡Œã‚ã‚Œã¾ã›ã‚“ã€‚
      </p>
      <p style="margin-top: 1rem; font-size: 0.8rem;">
        vNext Ledger â€” local-first decision tracking.
      </p>
      <p style="margin-top: 0.5rem; font-size: 0.7rem; opacity: 0.6;">
        Internal toolâ€”inspired design
      </p>
    </footer>

  </div>
</body>
</html>